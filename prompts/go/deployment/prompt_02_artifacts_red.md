# **Prompt 02: Integration Test for Artifact Registry Helper**

**Objective:** Generate a complete integration test for the `EnsureArtifactRegistryRepositoryExists` helper function.

**TDD Phase:** Red

## **Primary Prompt (Concise)**

Your task is to generate the Go code for the `deployment/artifacts_integration_test.go` file.

Write a complete integration test for the `EnsureArtifactRegistryRepositoryExists` function, which does not yet exist. The test **must not** use mocks. It must use a live Google Cloud environment to verify that the function correctly creates a repository and that it is idempotent (i.e., running it a second time does not cause an error).

## **Reinforcement Prompt (Detailed Context)**

**Persona:** You are an expert Go developer specializing in writing robust integration tests for Google Cloud services.

**Your Specific Task:** Generate the complete code for `deployment/artifacts_integration_test.go`.

**Key Requirements to Fulfill:**

* **Package:** The test file must be in the `deployment_test` package.
* **Environment:** The test must use real GCP credentials, reading the project ID from an environment variable. It should be skipped if the variable is not set.
* **Tagging:** The file **must** include the `//go:build integration` build tag.
* **(L2-1.3) Test Idempotency:** The test logic must perform the following steps:
    1.  Define a unique repository name for the test run to avoid collisions.
    2.  Set up a deferred cleanup (`t.Cleanup`) to delete the repository after the test completes.
    3.  Call `EnsureArtifactRegistryRepositoryExists` the **first time**. Assert that it returns no error.
    4.  Verify directly with the `artifactregistry.Client` that the repository now exists.
    5.  Call `EnsureArtifactRegistryRepositoryExists` a **second time** with the same arguments. Assert that it still returns no error, proving it is idempotent.

**Dependencies (Full source code to be provided):**

1.  `deployment/artifacts.go` (The file to be generated by the Green prompt)

---

## Prompt Changelog

### RV_20250901

This is the initial version of the prompt for the Artifact Registry helper function. It specifies an integration test to validate the function's idempotent behavior against the live cloud service.