# **Introduction: A Guide to Prompt-Driven Development**

This document outlines the architecture and methodology of the (go-)cloud-manager project, a complex Go application for declarative cloud orchestration generated using a sophisticated, prompt-driven development lifecycle.

## **1\. Motivation: Beyond Simple Code Generation**

The primary goal of this project is to create a maintainable, verifiable, and production-ready cloud management tool through a partnership between human developers and a Large Language Model (LLM).

While an LLM can generate code from simple instructions, creating a complex system requires a more rigorous approach. Simple, monolithic prompts are brittle, difficult to maintain, and rarely produce code that is robust, testable, and architecturally sound. This project rejects that approach in favor of a system where **requirements, prompts, and code are treated as interconnected, version-controlled, first-class citizens.** The motivation is to build not just the final application, but a self-improving and maintainable "code factory" powered by a suite of high-fidelity prompts.

## **2\. The Red-Green-Refine Methodology**

Our development lifecycle is built on a Test-Driven Development (TDD) foundation, extended with a crucial feedback loop we call the "Refine" phase.

### **a. Preprompts: Establishing a Deep Context**

Before any code for a major package (like servicemanager or iam) is generated, we provide the LLM with a **preprompt**. This document is a master set of instructions for the entire package. It establishes a deep, shared context by defining:

* **The Goal:** The package's high-level purpose and architecture.
* **The Persona:** The expert role the LLM should adopt.
* **Critical Guardrails:** Unbreakable rules and patterns to follow. This is especially important for navigating known complexities, such as the inconsistencies in Google Cloud's various IAM APIs, which prevents common LLM hallucinations.

### **b. The Red \-\> Green TDD Cycle**

Once the context is set, we generate each component using a strict TDD cycle.

1. **The "Red" Phase (Tests First):** We first generate the tests for a component that does not yet exist. These tests, whether unit or integration, act as a precise, **executable specification**. They define exactly what the final code must do, including its public API, behavior, and edge cases.
2. **The "Green" Phase (Implementation):** We then provide the LLM with the component's interface and the failing "Red" test file. The primary instruction is simple: "make the tests pass." This ensures that the generated code is, by design, correct according to its specification.

### **c. The "Refine" Phase: The Self-Improving Feedback Loop**

The "Refine" phase is the most critical part of our methodology. It is the mechanism by which we capture human expertise and continuously improve the entire system.

1. **Compare:** We compare the initial "Green" code generated by the LLM with the final, human-reviewed and committed production code.
2. **Identify:** We identify the gaps. These could be bug fixes, the use of a more modern library version, a more robust architectural pattern, or a better way to handle an error.
3. **Update:** We then **update the original Red and Green prompts**, adding new, more specific instructions that would have caused the LLM to generate the final, improved code directly.
4. **Log:** The rationale for these changes is captured in an **additive changelog** at the end of each prompt file, creating a versioned history of the prompt's evolution.

This feedback loop ensures that human knowledge is not lost in one-off fixes. Instead, it is permanently encoded into the prompt suite, making the entire "code factory" smarter and more capable over time.

## **3\. Maintenance: The Tripartite System**

This project is a living system composed of three core artifacts: **Requirements**, **Prompts**, and **Code**. We recognize that a valid change can originate from any of these three points.

* A **Requirements** change (e.g., adding a new feature in an L1 document) is a top-down modification.
* A **Prompt** change (e.g., improving an instruction to get better output) is a change in the "blueprint."
* A **Code** change (e.g., a developer directly fixing a bug or refactoring a function) is a bottom-up modification.

Our maintenance philosophy is governed by one fundamental rule: **after any change, the tripartite system must be brought back into alignment.**

If a developer changes the code, the prompts that generate that code must be updated to reflect the change, and the requirements that the code fulfills must be reviewed for impact. If a requirement is changed, the prompts and code must be regenerated and validated. This ensures that our prompt suite remains a high-fidelity, verifiable, and always-current representation of our production codebase.

## Sections

Requirements
* The requirements [plan](requirements_plan.md) 
* L1, L2, L3 [requirements](reqirements)  

Prompts
* [go](prompts/go
* * overall [meta](prompts/go/meta_prompt.md) prompt for golang development
* * golang [codestyle](prompts/go/golang_codestyle.md) to guide LLM 

Project Structure
* [servicemanager](prompts/go/servicemanager) core architecture and resource definition from MicroserviceArchitecture
* [iam](prompts/go/iam) plan and monitor IAM permissions from MicroserviceArchitecture (go/yaml) resource definition
* [deployment](prompts/go/deployment) manage cloud run deployments
* [conductor](prompts/go/conductor) co-ordinate and optimise all stages for full MicroserviceArchitecture deployment

* [servicedirector](prompts/go/servicedirector) deployable microservice that manages resource creation and discovery

### Human Delivery

There are a large number of prompts to be applied according to a [human](human_delivery) based
delivery plan. The long term goal is to automate generation but there is still significant human-in-the-loop presence
required for of TDD red-green-refactor loops.

### Implementation

The golang, LLM generated, version of cloud-manager is available at [go-cloud-manager](https://github.com/illmade-knight/go-cloud-manager)
